---
layout: page
group: 20
level: 1
title: 10.4  Merge process
---

For the consumer of a JSON formatted response that leverages metadata, objects are obtained in their 
entirety by merging the prototype with the payload information.  The information in the payload has 
precedence and overlays/overrides the prototype definitions. [11](#11)

The interplay between prototype and payload has several key attributes:

*  Metadata is expressed in JSON.
*  Metadata is available at the resource kind level and ideally even finer-granular levels.
*  Ability to override metadata at any level (feed/entry/property).
*  Reduce verbosity of transferred information.

The merge process is a conceptual process, meaning that a consumer will likely use a variety of local 
techniques to efficiently implement it while maintaining the same overall effect.

Example:  Consider the following prototype:

<pre>
{
    "$baseUrl": "http://www.example.com/sdata/MyApp/-/-",
    "$url": "{$baseUrl}/addresses",
    "$title": "Address list",
    "$properties": {
        "ID": {
            "$title": "AddressId",
            "$type": "sdata/integer",
            "$isMandatory": true
        },
        "Street": {
            "$title": "Street",
            "$type": "sdata/string",
            "$isMandatory": true
        },
        "StreetNumber": {
            "$title": "Number",
            "$type": "sdata/integer"
        },
        "City": {
            "$title": "City",
            "$type": "sdata/string",
            "$isMandatory": true
        },
        "PostalCode": {
            "$title": "ZipCode",
            "$type": "sdata/string",
            "$isMandatory": true
        },
        "Country": {
            "$title": "Country",
            "$type": "sdata/reference",
            "$links": {
                "$prototype": {
                    "$id": "lookup", 
                    "$url": "{$baseUrl}/$prototypes/countries('{$id}')",
                    "$title": "Country lookup prototype"
                }
            },
            "$url": "http://www.example.com/sdata/MyApp/-/-/countries('{ISOCode}')",
            "$isMandatory": true,
            "$item": {
                "$properties": {
                    "Name": {
                        "$title": "Country name",
                        "$type": "sdata/string",
                        "$isMandatory": true
                    },
                    "ISOCode": {
                        "$title": "Country code",
                        "$type": "sdata/string",
                        "$isMandatory": true
                    }
                }
            }
        }, 
        "$links": {
            "$prototype": {
                "$id": "list", 
                "$url": "{$baseUrl}/$prototypes/addresses('{$id}')",
                "$title": "Address feed prototype" 
            }
        }
    }
}
</pre>

Matching the previous prototype is the following JSON formatted payload:

<pre>
{
    <span style="background-color:#86b2d1;">"$baseUrl": "http://www.example.com/sdata/MyApp/-/-",</span>
    <span style="background-color:#ffff00;">"$url": "{$baseUrl}/addresses?creditLimitExceeded=true"</span> ,
    <span style="background-color:#ffff00;">"$title": "Addresses of accounts with exceeded credit limit"</span> ,
    <span style="background-color:#86b2d1;">"$resources": [</span>
        <span style="background-color:#86b2d1;">{</span>
            <span style="background-color:#86b2d1;">"ID": "7123a",</span>
            <span style="background-color:#86b2d1;">"Street": "Lerchenweg",</span>
            <span style="background-color:#86b2d1;">"StreetNumber": 11,</span>
            <span style="background-color:#86b2d1;">"PostalCode": 71711,</span>
            <span style="background-color:#86b2d1;">"City": "Marbach am Neckar",</span>
            <span style="background-color:#86b2d1;">"Country": {</span>
                <span style="background-color:#86b2d1;">"Name": "Germany",</span>
                <span style="background-color:#86b2d1;">"ISOCode": "DE"</span>
            <span style="background-color:#86b2d1;">},</span>
            <span style="background-color:#86b2d1;">"$properties": {</span>
                <span style="background-color:#86b2d1;">"PostalCode": {</span>
                    <span style="background-color:#ffff00;">"$isMandatory": false</span>
                <span style="background-color:#86b2d1;">}</span>
            <span style="background-color:#86b2d1;">}</span>
        <span style="background-color:#86b2d1;">},</span>
        <span style="background-color:#86b2d1;">{</span>
            <span style="background-color:#86b2d1;">"ID": "hw7631",</span>
            <span style="background-color:#86b2d1;">"Street": "Fleet Street",</span>
            <span style="background-color:#86b2d1;">"StreetNumber": 31,</span>
            <span style="background-color:#86b2d1;">"City": "London",</span>
            <span style="background-color:#86b2d1;">"PostalCode": "EC4Y 8EQ",</span>
            <span style="background-color:#86b2d1;">"Country": {</span>
                <span style="background-color:#86b2d1;">"Name": "United Kingdom",</span>
                <span style="background-color:#86b2d1;">"ISOCode": "GB"</span>
            <span style="background-color:#86b2d1;">}</span>
        <span style="background-color:#86b2d1;">}</span>
    <span style="background-color:#86b2d1;">]</span>
}
</pre>

The above payload provides, in addition to the payload (in blue) a series of specific metadata (in yellow 
background) for: 

*  The URL of the feed ($url)
*  The title of the feed ($title) 
*  The type of the first - German - address, that must be numeric according to German rules

After the merge process, the logical JSON object will contain the following:

<pre>
{
    <span style="background-color:#86b2d1;">"$baseUrl": "http://www.example.com/sdata/MyApp/-/-",</span>
    <span style="background-color:#ffff00;">"$url": "{$baseUrl}/addresses?creditLimitExceeded=true",</span>
    <span style="background-color:#86b2d1;">"$title": "Addresses of accounts with exceeded credit limit",</span>
    <span style="background-color:#86b2d1;">"$resources": [</span>
        <span style="background-color:#86b2d1;">{</span>
            <span style="background-color:#86b2d1;">"ID": "7123a",</span>
            <span style="background-color:#86b2d1;">"Street": "Lerchenweg",</span>
            <span style="background-color:#86b2d1;">"StreetNumber": 11,</span>
            <span style="background-color:#86b2d1;">"PostalCode": 71711,</span>
            <span style="background-color:#86b2d1;">"City": "Marbach am Neckar",</span>
            <span style="background-color:#86b2d1;">"Country": {</span>
                <span style="background-color:#86b2d1;">"Name": "Germany",</span>
                <span style="background-color:#86b2d1;">"ISOCode": "DE"</span>
            <span style="background-color:#86b2d1;">},</span>
            "$properties": {
                "ID": {
                    "$title": "AddressId", 
                    "$type": "sdata/integer", 
                    "$isMandatory": true
                },
                "Street": {
                    "$title": "Street", 
                    "$type": "sdata/string", 
                    "$isMandatory": true
                },
                "StreetNumber": {
                    "$title": "Number", 
                    "$type": "sdata/integer"
                }, 
                "City": { 
                    "$title": "City", 
                    "$type": "sdata/string", 
                    "$isMandatory": true
                }, 
                "PostalCode": {
                    "$title": "ZipCode", 
                    "$type": "sdata/string", 
                    <span style="background-color:#ffff00;">"$isMandatory": false</span>
                }, 
                "Country": {
                    "$title": "Country", 
                    "$type": "sdata/reference", 
                    "$links": {
                        "$prototype": {
                            "$id": "lookup", 
                            "$url": "{$baseUrl}/$prototypes/countries('{$id}')",
                            "$title": "Country lookup prototype"
                        }
                    },
                    "$url": "http://www.example.com/sdata/MyApp/-/-/countries('{ISOCode}')",
                    "$prototype": "{$baseUrl}/$prototypes/countries('lookup')", 
                    "$isMandatory": true, 
                    "Name": {
                        "$title": "Country name", 
                        "$type": "sdata/string", 
                        "$isMandatory": true
                    }, 
                    "ISOCode": {
                        "$title": "Country code", 
                        "$type": "sdata/string", 
                        "$isMandatory": true
                    } 
                }
            },
            "$links": {
                "$prototype": {
                    "$id": "list", 
                    "$url": "{$baseUrl}/$prototypes/addresses('{$id}')",
                    "$title": "Address feed prototype" 
                }
            }
        <span style="background-color:#86b2d1;">}, </span>
        <span style="background-color:#86b2d1;">{ </span>
            <span style="background-color:#86b2d1;">"ID": "hw7631", </span>
            <span style="background-color:#86b2d1;">"Street": "Fleet Street", </span>
            <span style="background-color:#86b2d1;">"StreetNumber": 31, </span>
            <span style="background-color:#86b2d1;">"City": "London", </span>
            <span style="background-color:#86b2d1;">"PostalCode": "EC4Y 8EQ",</span>
            <span style="background-color:#86b2d1;">"Country": {</span>
                <span style="background-color:#86b2d1;">"Name": "United Kingdom", </span>
                <span style="background-color:#86b2d1;">"ISOCode": "GB"</span>
            <span style="background-color:#86b2d1;">},</span>
            "$properties": {
                "...": "...",
                "PostalCode": {
                    "$title": "ZipCode",  
                    "$type": "sdata/string",
                    "$isMandatory": true
                }
            },
            "$links": {
                "$prototype": {
                    "$id": "list", 
                    "$url": "{$baseUrl}/$prototypes/addresses('{$id}')",
                    "$title": "Address feed prototype" 
                }
            }
        <span style="background-color:#86b2d1;">} </span>
    <span style="background-color:#86b2d1;">]</span>
}
</pre> 

Please note that the $type of the PostalCode property of the first address object is 'sdata/integer'
as overridden by the provider.

***
<a name="11">11</a>. To remove a metadata element defined in the prototype, the payload defines the property with null value.