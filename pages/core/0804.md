---
layout: page
group: core
level: 1
title: 8.4 Reliable Posting
---

The <tt>POST</tt> operation needs special care if we want it to work reliably
over communication channels.&nbsp;For example,&nbsp;any network that involves the public
Internet will have a level of unreliability.

The problem is that the HTTP protocol does not guarantee&nbsp;a request is
delivered once and only once. Instead, the request may never reach the
destination in which case the sender will get an error. Or it may be delivered
several times even if sent only once, and the sender will not know it. Also, the
sender may get a timeout even though the request has been successfully delivered
and processed on the provider side. This can be summarized by saying that HTTP
guarantees almost nothing when it comes to message delivery. The only guarantee
is that you know that the message has been received at least once if you receive
an HTTP response, i.e., a <tt>2xx</tt>, <tt>3xx</tt>, <tt>4xx</tt> or
<tt>5xx</tt> status code.

This is not an issue for <tt>GET</tt> operations because these operations are
“safe”. They don't have observable side-effects on the provider side. Neither is
it an issue for&nbsp;<tt>PUT</tt> and <tt>DELETE</tt> operations because these
operations are “idempotent” (their side effects remain the same if called
several times).&nbsp;Executing them a second time does not change the observable
state of the service provider. <tt>GET</tt> operations are also idempotent
because they are "safe".

However,&nbsp;this is a problem for <tt>POST</tt> operations. If a resource
creation request is delivered twice and if we don't take any preventive action,
the service provider will create two resources.

This problem can be handled at two levels:

*   At the application level, by designing the resources so that a duplicate
<tt>POST</tt> will not do any harm. This is the solution presented in the
<tt>POST</tt> example of this section. The <tt>&lt;salesOrder&gt;</tt> payload
contains <tt>sdata:uuid</tt> values that the provider stores in its database.
The universally unique identifiers (UUIDs) are generated by the consumer. With
this approach, the provider can detect a duplicate <tt>POST</tt> of the same
request.

*   At the protocol level, by passing additional information outside&nbsp;the payload
(outside&nbsp;the <tt>&lt;salesOrder&gt;</tt> element in the example). The advantage
of this approach is that it does not require any change to the application's
data model (although the systematic introduction of a UUID is encouraged because
it can help with other issues like synchronization).

SData provides a “protocol level” mechanism for reliable POSTing.&nbsp;The
mechanism consists in adding a trackingID parameter to the POST URL. It is
similar the SData protocol for [Asynchronous Service Operations](../1105/ "11.5 Asynchronous Operations"). Here is an example:

<pre>POST /sdata/myApp/myContract/-/salesOrders?trackingID=abc42b0d-d110-4f5c-ac79-d3aa11bd20cb </pre>

<blockquote class="note">The consumer generates the UUID and passes it via the
<tt>trackingID</tt> parameter.</blockquote>

The provider will treat this request as an asynchronous request and it will
send a response like:

<pre>202 Accepted
Location: http://www.example.com/sdata/myApp/myContract/-/salesOrders/$post('abc42b0d-d110-4f5c-ac79-d3aa11bd20cb')
Content-Type: application/xml
&nbsp;
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;tracking xmlns="http://schemas.sage.com/sdata/2008/1"&gt;
&nbsp;&nbsp;&lt;phase&gt;Initialization&lt;/phase&gt;
&nbsp;&nbsp;&lt;phaseDetail&gt;Starting thread&lt;/phaseDetail&gt;
&nbsp;&nbsp;&lt;progress&gt;0.0&lt;/progress&gt;
&nbsp;&nbsp;&lt;elapsedSeconds&gt;0&lt;/elapsedSeconds&gt;
&nbsp;&nbsp;&lt;remainingSeconds&gt;7&lt;/remainingSeconds&gt;
  &lt;pollingMillis&gt;500&lt;/pollingMillis&gt;
&lt;/tracking&gt;</pre>

The <tt>Accepted</tt> status code indicates that the server has accepted the
request and the <tt>Location</tt> header gives the URL that the consumer MUST
use to track the progress of the operation (see section on
[Asynchronous Service Operations](../1105/ "11.5 Asynchronous Operations") for more details).

The consumer MUST track the progress of the POST operation by sending GET
requests on the tracking URL:
<tt>http://www.example.com/sdata/myApp/myContract/-/salesOrders/$post('abc42b0d-d110-4f5c-ac79-d3aa11bd20cb')</tt>,
until its gets a response status other than <tt>202</tt>.

If the POST is successful, the consumer will receive a response like:

<pre>201 Created
Content-Type: application/atom+xml; type=entry
Location: http://www.example.com/sdata/myApp/myContract/-/salesOrders('43663')
ETag: 2nXz9DZYR2pqmcXi/ZCbYA==&nbsp;

&lt;entry xmlns:sdata="http://schemas.sage.com/sdata/2008/1" 
       xmlns:http="http://schemas.sage.com/sdata/http/2008/1" 
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  xmlns="http://www.w3.org/2005/Atom"&gt;
&nbsp; &lt;id&gt;http://www.example.com/sdata/myApp/myContract/-/salesOrders('43663')&lt;/id&gt;
&nbsp; &lt;title&gt;Sales Order 43663&lt;/title&gt;
&nbsp; &lt;updated&gt;2008-03-31T13:46:45Z&lt;/updated&gt;
  &lt;!-- more elements - skipped for clarity --&gt;
&lt;/entry&gt;</pre>

At this stage, the consumer MUST delete the tracking context with a call
like:

<pre>DELETE http://www.example.com/myApp/myContract/-/salesOrders/$post('abc42b0d-d110-4f5c-ac79-d3aa11bd20cb')</pre>

<blockquote class="note">The tracking id identifies the context of the POST operation. It
allows the caller to track the progress of the operation and delete the context
at the end. It should not be confused with the id of the resource created by the
operation (<tt>43663</tt> in the example).</blockquote>

<blockquote class="compliance">SData providers MAY support the reliable posting protocol based
on the <tt>trackingID</tt> parameter.</blockquote>

* * *