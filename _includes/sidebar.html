<!--span>{{page.title}} - {{page.group}}</span-->
<script>
$(document).ready(function(){

	document.title = "{{site.title}} - " + $('#breadcrumb > div > span.bc-page-title').text();
	
	var path = window.location.pathname;
	var active = $("ul.navigation ul a[href*='"+path+"']").parent().parent();
	if(active.length == 0) active = $("ul.navigation > li > a[href*='"+path+"']").parent().find('ul');
	//console.log(active.length);

	$('ul.navigation ul').not(active).hide();
	active.parent().addClass('active-top');
  
	/*$('ul.navigation > li > a.childs-only').click(function(){
		//$('ul.navigation ul').not(active).hide();
		//$(this).parent().find('ul').not(active).slideToggle(200);
		$(this).parent().find('ul').slideToggle("slow");
	});*/
  
});
</script>

{% assign categories = "core|sync|sdata-20" | split: "|" %}

<ul class="top-nav">
	<li><a id="core" class="{% if page.group == 'core' %}active{% endif %}" href="{{site.baseurl}}/pages/core/0100/">SData 1.1 Core</a></li>
	<li><a id="sync" class="{% if page.group == 'sync' %}active{% endif %}" href="{{site.baseurl}}/pages/sync/0000/">SData 1.1 Sync</a></li>
	<li><a id="sdata-20" class="{% if page.group == 'sdata-20' %}active{% endif %}" href="{{site.baseurl}}/pages/20/01-0000/">SData 2.0</a></li>
</ul>

{% for category in categories %}
<ul class="navigation {{category}}" style="display:{% if category != page.group %}none{% else %}inline-block{% endif %}">

{% assign menuitem = 'top' %}
{% assign isToplevelOpen = false %}

{% for p in site.pages %}
    {% if p.group == category %}
		{% if p.level == 0 %}
			{% if isToplevelOpen %} {% if menuitem == 'sub' %} </ul> {% endif %} </li> {% endif %}
			{% assign isToplevelOpen = true %}
			{% assign menuitem = 'top' %}
			<li {% if p.url == page.url %}class="activeli"{% endif %}>
				
				<a {% if p.layout != null %}id="{{p.group}}_{{p.name | replace:'.','_' }}" href="{{site.baseurl}}{{p.url}}"{% else %}class="childs-only" style="cursor: pointer;"{% endif %} {% if p.url == page.url %}class="active"{% endif %}>{{p.title}}</a>
		{% endif %}
		{% if p.level > 0 %}
			{% if menuitem == 'top' %} <ul class="sub"> {% endif %}
			{% assign menuitem = 'sub' %}
			
				<li {% if p.url == page.url %}class="activeli"{% endif %}>
					<a id="{{p.group}}_{{p.name | replace:'.','_' }}" href="{{site.baseurl}}{{p.url}}" {% if p.url == page.url %}class="active"{% endif %}>{{p.title}}</a>
				</li>
			
		{% endif %}
    {% endif %}
{% endfor %}

<!-- close tag(s) for last menu item -->
{% if isToplevelOpen %} {% if menuitem == 'sub' %} </ul> {% endif %} </li> {% endif %}
</ul>
{% endfor %}

<script type="text/javascript">

function getInternetExplorerVersion()
// Returns the version of Internet Explorer or a -1
// (indicating the use of another browser).
{
  var rv = -1; // Default value assumes failure. 
  var ua = navigator.userAgent;

  // If user agent string contains "MSIE x.y", assume
  // Internet Explorer and use "x.y" to determine the
  // version.
 
  var re  = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
  if (re.exec(ua) != null) 
    rv = parseFloat( RegExp.$1 );
  return rv;

}

function navigateTo (id)
{
	//# $('#sidemenu ul > li > ul > li > a').removeClass('active');
	$('#sidemenu ul.navigation:visible').find('li > ul > li > a').removeClass('active');
	
	/*$('ul.navigation > li').removeClass('active-top').find('a.active').removeClass('active');
	$('ul.navigation > li > ul').slideUp(100, 'swing');
	*/
	if(!$('#' + id).parent().parent().is(':visible'))
	{
		$('ul.navigation > li').removeClass('active-top').find('a.active').removeClass('active');
		$('ul.navigation > li > ul').slideUp(100, 'swing');
		if($('#' + id).parent().parent().hasClass('sub'))
		{
			$('#' + id).parent().parent().parent().addClass('active-top');
			$('#' + id).parent().parent().slideDown(600);
		}
	}
	else if($('#' + id).parent().parent().hasClass('navigation'))
	{
		$('ul.navigation > li > ul').slideUp(100, 'swing');
		
		if ($('#' + id).parent().find('ul').length > 0)
			$('#' + id).parent().find('ul').slideDown(600);
		
		$('ul.navigation > li').removeClass('active-top').find('a.active').removeClass('active');
	}
	$('#' + id).addClass('active');	
}

jQuery(document).ready(function($) {

	switch(getInternetExplorerVersion())
	{
		case 7:
		case 8:
		case 9:
			$('ul.navigation > li > a.childs-only').click(function(){
				//$('ul.navigation ul').not(active).hide();
				//$(this).parent().find('ul').not(active).slideToggle(200);
				$(this).parent().find('ul').slideToggle("slow");
			});
			break;
		
		default: 
		//var siteUrl = 'http://'+(document.location.hostname||document.location.host);
		var siteUrl = '{{site.baseurl}}/pages/';

		// Make sure that all clicked links that link to your internal website
		// don't just reload the page but execute a History.pushState call
		$(document).delegate('#sidemenu a[href^="'+siteUrl+'"], .inner-content a[href^="'+siteUrl+'"], a.ajax[href^="'+siteUrl+'"], a.childs-only', "click", function(e) {
			
			if($(this).hasClass('childs-only'))
				$(this).attr('href', $(this).parent().find('ul > li > a:first-of-type').attr('href'));
			
			//console.log(e);
			//console.log($(this));
			
			// if search-result page => redirect to clicked page
			if($('#content').find('a.search-result').length > 0 || $('#content').find('.outer-content').length == 0)
			{
				window.location.href = $(this).attr('href');
			}
			
			e.preventDefault();
			History.pushState({}, "", this.pathname);
			
			// sidemenu link?
			var ulType = $(this).parent().parent().is('ul') ? ($(this).parent().parent().hasClass('navigation') ? 'navigation' : $(this).parent().parent().hasClass('sub') ? 'sub' : $(this).parent().parent().hasClass('top-nav') ? 'top-nav' : 'content') : 'content';
			
			//console.log(ulType);
			switch(ulType)
			{
				case 'top-nav':
					
					group = $(this).attr('id');
					if(!$(this).hasClass('active'))
					{
						$('ul.navigation:visible').hide("slide", { direction: "left" }, 1000, function(){
							$('ul.'+group).show("slide", { direction: "left" }, 600, function(){
								if($(this).children().first().find('ul').length > 0)
								{
									$('#sidemenu ul > li > ul > li > a').removeClass('active');
									$(this).children().first().addClass('active-top').find('ul').slideToggle(600);
									if($(this).hasClass('childs-only')) $(this).children().first().find('ul.sub').children(':first').find('a').addClass('active');
								}
							});
						});
					}
					
					$('ul.top-nav > li').find('a.active').removeClass('active');
					$(this).addClass('active');
					break;
				
				case 'navigation':

					$('ul.navigation > li').removeClass('active-top').find('a.active').removeClass('active');
					
					$('ul.navigation > li > ul').slideUp(100, 'swing');
					// top with subitems
					if($(this).parent().find('ul').length > 0)
					{
						$('#sidemenu ul > li > ul > li > a').removeClass('active');
						$(this).parent().addClass('active-top').find('ul').slideToggle(600);
						if($(this).hasClass('childs-only')) $(this).parent().find('ul.sub').children(':first').find('a').addClass('active');
					}
					else {} // empty top

					$(this).addClass('active');
					break;
				
				case 'sub':
					$('#sidemenu ul > li > ul > li > a').removeClass('active');
					$(this).addClass('active');
					break;
				
				default:
					/* moved to navigateTo(id) function */
			}
		});

		// Catch all History stateChange events
		History.Adapter.bind(window, 'statechange', function(){
			var State = History.getState();

			// Load the new state's URL via an Ajax Call
			$.get(State.url, function(data){

				// Replace previous/next buttons on page
				$('#contentBorderTop').html($(data).find('#prevNextTop'));
				$('#contentBorderBottom').html($(data).find('#prevNextBottom'));
				
				// Replace the content
				$('.outer-content').html($(data).find('.inner-content'));
				
				// refresh breadcrumb
				$('#breadcrumb').html($(data).find('#breadcrumb > div'));

				// refresh side menu
				navigateTo($(data).find('#content').attr('class'));	// menu item id is in class of content container every page
				
				// refresh site title
				document.title = "{{site.title}} - " + $('#breadcrumb > div > span.bc-page-title').text();
				
				$('pre, code').each(function(i, block) {
					hljs.highlightBlock(block);
				});
				
				// If you're using Google analytics, make sure the pageview is registered!
				/*ga('send', 'pageview', {
					'page': State.url,
					'title': document.title
				});*/
			});
		});
	}
});
</script>

